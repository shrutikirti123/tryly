<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Dress Try-On</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.0.0/firebase-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.0.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA4T3g9R6yLPuZzo1PVBfTo2uchwgw8AW4",
            authDomain: "tryly-b419f.firebaseapp.com",
            projectId: "tryly-b419f",
            storageBucket: "tryly-b419f.firebasestorage.app",
            messagingSenderId: "295245429248",
            appId: "1:295245429248:android:4b065b24228c969971f6e5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function fetchUserMeasurements() {
            try {
                const querySnapshot = await db.collection("user_measurements").orderBy("timestamp", "desc").limit(1).get();
                if (!querySnapshot.empty) {
                    const data = querySnapshot.docs[0].data();
                    document.getElementById("measurements").innerText = JSON.stringify(data, null, 2);
                    load3DModel(data);
                } else {
                    console.error("No measurement data found.");
                }
            } catch (error) {
                console.error("Error fetching measurements:", error);
            }
        }

        async function load3DModel(measurements) {
            const selectedDress = document.getElementById("dressSelector").value;
            if (!selectedDress) return;
            
            const response = await fetch(`https://your-firebase-url/3D_models/${selectedDress}.json`);
            const data = await response.json();
            
            const modelViewer = document.getElementById("arViewer");
            modelViewer.setAttribute("src", data.url);
            
            if (measurements && measurements.height) {
                const scaleFactor = measurements.height / 170;
                modelViewer.setAttribute("scale", `${scaleFactor} ${scaleFactor} ${scaleFactor}`);
            }
        }
    </script>
</head>
<body onload="fetchUserMeasurements()">
    <h2>Select a Dress for Try-On</h2>
    <select id="dressSelector" onchange="fetchUserMeasurements()">
        <option value="">-- Select Dress --</option>
        <option value="red_dress">Red Dress</option>
        <option value="blue_gown">Blue Gown</option>
    </select>
    <br>
    <model-viewer id="arViewer" auto-rotate camera-controls ar ar-modes="scene-viewer webxr" style="width: 100%; height: 500px;"></model-viewer>
    <pre id="measurements"></pre>
</body>
</html>
